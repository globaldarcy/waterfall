<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>waterfall</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        #main {
            position: relative;
            margin: 0 auto;
        }

        .box {
            padding: 15px 0 0 15px;
            float: left;
        }

        .pic {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 5px #ccc;
        }

        .pic img {
            width: 165px;
            height: auto;
        }
    </style>
</head>
<body style="max-width: 900px; margin: 0 auto;">
<div id="main">
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/5a2926df15a72b5db4b64a262a3fdca37b67b5c5.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/9dd53e614ca27e4861cdadb28cc28589b7fbd95a.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/b58cda8cbf922faab29e9ce380e5894d84630eae.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/2820b7ccd8cc33cf721cc71173963e7c91da9e68.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/8462d92a3e4229b2a64f486f3f625b4561268823.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/09c69d8f31ca72526211425fd15323ac75fbb9f7.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/8a58b4e7b7c785dcfefb3774a66504fa3f48b1fc.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/51638449119f5a577e53b9bbba5afec60a9cfa59.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/429f2167c6a5c50a2723f1c9bfc9a5c73f9fd3c0.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/99408c5922144d97b087f222de50d7d912ee5c61.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/4ea3fd2ab5355e6234a8431e733f9041517a4783.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/b1073fe3d190c627672bab66534e2b111a28a9de.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/d66715d84d41fd3a6f217054f30698a3e64e9788.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/9dd53e614ca27e4861cdadb28cc28589b7fbd95a.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/115893318605a3364f8c55352375f4a7f3bd6ea0.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/058f800eb82ae0555fa950500917b08491c8a5d6.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/de5a2e495032357d88a61bff0936a13b8b24b679.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/8e467909cd76ae7a6c841a34637d89d5c6081b27.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/76710f4f84fba1f5bd0cce9a7f7f9b1894478b66.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/c6b624b9b1608a55b936f9e6c6b26313ac553ae1.jpeg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="http://res.jisuanke.com/img/upload/20160314/99408c5922144d97b087f222de50d7d912ee5c61.jpeg">
        </div>
    </div>
</div>
<script>
    var dataInit = {
        'data': [
            {'src': 'http://res.jisuanke.com/img/upload/20160314/5a2926df15a72b5db4b64a262a3fdca37b67b5c5.jpeg'}
            , {'src': 'http://res.jisuanke.com/img/upload/20160314/9dd53e614ca27e4861cdadb28cc28589b7fbd95a.jpeg'}
            , {'src': 'http://res.jisuanke.com/img/upload/20160314/b58cda8cbf922faab29e9ce380e5894d84630eae.jpeg'}
            , {'src': 'http://res.jisuanke.com/img/upload/20160314/2820b7ccd8cc33cf721cc71173963e7c91da9e68.jpeg'}
            , {'src': 'http://res.jisuanke.com/img/upload/20160314/8462d92a3e4229b2a64f486f3f625b4561268823.jpeg'}
            , {'src': 'http://res.jisuanke.com/img/upload/20160314/09c69d8f31ca72526211425fd15323ac75fbb9f7.jpeg'}
        ]
    };
    function waterfall(parent, sclass) {
        var oParent = document.getElementById(parent);
        var aBox = document.getElementsByClassName(sclass);
        var boxwidth = aBox[0].offsetWidth;
        var documentwidth = document.body.clientWidth;
        var cnum = Math.floor(documentwidth / boxwidth);
        oParent.style.width = boxwidth * cnum + 'px';
        var aBoxHeight = new Array();
        for (var i = 0; i < aBox.length; i++) {
            if (i < cnum) {
                aBox[i].style.top = 0 + 'px';
                aBox[i].style.left = boxwidth * i + 'px';
                aBoxHeight.push(aBox[i].offsetHeight);
            }
            else {
                var minHeight = Math.min.apply(null, aBoxHeight);
                var minIndex = getIndex(aBoxHeight, minHeight);
                aBox[i].style.position = 'absolute';
                aBox[i].style.top = minHeight + 'px';
                aBox[i].style.left = aBox[minIndex].offsetLeft + 'px';
                aBoxHeight[minIndex] += aBox[i].offsetHeight;
            }
        }
    }
    function getIndex(arr, value) {
        for (var i in arr) {
            if (arr[i] == value) return i;
        }
    }
    window.onload = function () {
        waterfall('main', 'box');
    }
    function checkScrollside(sClass) {
        var aBox = document.getElementsByClassName(sClass);
        var lastImgIn = aBox[aBox.length - 1].offsetTop + Math.floor(aBox[aBox.length - 1].offsetHeight / 2);
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        var documentHeight = document.documentElement.clientHeight || document.body.clientHeight;
        return (lastImgIn < scrollTop + documentHeight);
    }
    window.onscroll = function () {
        if (checkScrollside('box')) {
            var oParent = document.getElementById('main');
            for (var i = 0; i < dataInit.data.length; i++) {
                var oBox = document.createElement('div');
                oBox.className = 'box';
                var oPic = document.createElement('div');
                oPic.className = 'pic';
                var oImg = document.createElement('img');
                oImg.src = dataInit.data[i].src;
                oPic.appendChild(oImg);
                oBox.appendChild(oPic);
                oParent.appendChild(oBox);
            }
            waterfall('main', 'box');
        }
    }
    window.onresize = function () {
        waterfall('main', 'box');
    }
</script>
</body>
</html>